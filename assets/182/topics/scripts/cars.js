var whichcars={accordion:function(h){if(!document.getElementById("how-we-test")&&!document.getElementById("standard-equipment")&&!document.getElementById("optional-extras")){return}var b=$(h),d=b.find("div div"),e=b.find("h2"),g=b.find("h3"),a="<a href='#' class='show'>Show</a>",f="<a href='#' class='hide'>Hide</a>",c="<a href='#' class='show'>Show all</a> / <a href='#' class='hide'>Hide all</a>";if(b.attr("id")==="side-by-side"){d=b.find("div.accordion div");e=b.find("div.accordion h2");g=b.find("div.accordion h3")}d.first().show();d.slice(1).hide();g.css("text-align","right").wrapInner("<span></span>");g.first().append(f);g.slice(1).append(a);g.on("click","a",function(){var i=$(this).parent().next("div");if(i.is(":visible")){$(this).replaceWith(a);i.slideUp()}else{$(this).replaceWith(f);i.slideDown()}return false});if(e.parent().parent().is("#sidebar")){e.css("text-align","right").wrapInner("<span></span>").append(c)}else{e.after("<p class='showHideAll'>"+c+"</p>")}b.on("click",".showHideAll a, h2 a",function(){whichcars.accordionActioner($(this),b,g,f,a);return false})},accordionActioner:function(d,b,f,e,a){var c;if(b.attr("id")==="side-by-side"){c=$(d).parents("div.accordion").find("div")}else{c=$(d).parents("div.accordion").find("div div")}if($(d).hasClass("show")){c.show();f.children("a").each(function(){$(this).replaceWith(e)})}else{c.hide();f.children("a").each(function(){$(this).replaceWith(a)})}},navigationAddHover:function(){$(this).addClass("hovering")},navigationRemoveHover:function(){$(this).removeClass("hovering")},navigationHoverInit:function(){var b=$("#category-nav").find("li"),a={interval:300,sensitivity:4,over:whichcars.navigationAddHover,timeout:0,out:whichcars.navigationRemoveHover};b.hoverIntent(a)},modelFinder:function(e){if(!document.getElementById("model-finder")&&!document.getElementById("car-finder")){return}var d=$(e),a=$("#used-cars"),b=$("#new-cars"),c=$("#age");whichcars.disableAgeSelect(a,b,c);d.find(":checkbox").change(function(){c.removeAttr("disabled");whichcars.disableAgeSelect(a,b,c)});c.change(function(){a.removeAttr("checked");if((!a.is(":checked"))&&($(this).val()!==1)){a.attr("checked","checked")}})},disableAgeSelect:function(a,b,c){if(!a.is(":checked")&&b.is(":checked")){c.attr("disabled","disbled")}},helpPopup:function(){if(!document.getElementById("inline-help")){return}$("#inline-help").hide();var a=$("#frame").find("a.help-link"),b=$('<div class="inner"></div>').dialog({autoOpen:false,title:"",dialogClass:"help-popup",closeText:"X",width:300,maxWidth:300,resizable:false,modal:true});a.click(function(){var e=$(this),f=((e.position().top)+10),c=((e.position().left)+10),d=$(e.attr("href")).clone().html();b.html(d).dialog("open").parents("div.help-popup").css({left:c,top:f});return false});$("#frame").click(function(){b.dialog("close")})},drillDownOption:function(b,i){if(!document.getElementById("review-finder")&&!document.getElementById("model-comparator-selector")&&!document.getElementById("range-comparator-selector")){return}var c=$(b),a=$("#make"),h=$("#range"),e=$("#style"),g=$("#model"),f=$(a).attr("value"),d=$("#selected_range").attr("value"),j,k;c.find("fieldset button[id='addrange']").hide();if(document.getElementById("review-finder")){c.find("select").css("width","270px")}else{c.find("select").css("width","208px")}c.find("select").change(function(){var l=$(this).attr("value");if(l!==""){if($(this).attr("id")==="make"){whichcars.ajaxMakeRangeBuilder(l,i,"",h,k)}else{if($(this).attr("id")==="range"){whichcars.ajaxRangeStyleBuilder(l,i,"",e,k);$("#selected_range").attr("value",l);if(e.length===0){$("#search").removeAttr("disabled");$("#searchreviewbutton").attr("src","http://staticwhich.co.uk/assets/topics/images/buttons/btn-go.png")}}else{if($(this).attr("id")==="style"){$("#selected_style").attr("value",l);if(g.length!==0){whichcars.ajaxModelsBuilder(l,i,g,k)}else{$("#search").removeAttr("disabled");$("#searchreviewbutton").attr("src","http://staticwhich.co.uk/assets/topics/images/buttons/btn-go.png")}}}}}c.find(".error").remove()});if(f!==null&&f!==""){whichcars.ajaxMakeRangeBuilder($(a).attr("value"),i,d,h,k);c.find(".error").remove()}if(d!==null&&d!==""){j=$("#selected_style").attr("value");whichcars.ajaxRangeStyleBuilder(d,i,j,e,k);c.find(".error").remove()}},ajaxMakeRangeBuilder:function(c,b,d,a,g){if(typeof(g)!=="undefined"){g.abort()}var f="/cars/ajax/"+b+"/marques"+c,e="";g=$.ajax({type:"GET",url:f,dataType:"json",error:function(h,j,i){},success:function(h){if(h.ranges!==undefined&&h.ranges.details.length!==0){$.each(h.ranges.details,function(k,j){e=e+'<option value="'+j.value+'">'+j.name+"</option>"})}a.html(e);a.removeAttr("disabled");if(d!==""){a.find("option[value="+d+"]").attr("selected","selected")}}})},ajaxRangeStyleBuilder:function(d,c,e,b,g){if(typeof(g)!=="undefined"){g.abort()}var f="/cars/ajax/"+c+"/bodyStyle"+d,a="";g=$.ajax({type:"GET",url:f,dataType:"json",error:function(h,j,i){},success:function(h){if(h.styles!==undefined&&h.styles.details.length!==0){$.each(h.styles.details,function(j,k){a=a+'<option value="'+k.value+'">'+k.name+"</option>"})}b.html(a);b.removeAttr("disabled");if(e!==""){b.find("option[value="+e+"]").attr("selected","selected")}}})},ajaxModelsBuilder:function(c,b,a,e){if(typeof(e)!=="undefined"){e.abort()}var d="/cars/ajax/"+b+"/models"+c,f="";e=$.ajax({type:"GET",url:d,dataType:"json",error:function(g,i,h){},success:function(g){if(g.models!==undefined&&g.models.details.length!==0){$.each(g.models.details,function(h,j){f=f+'<option value="'+j.value+'">'+j.name+"</option>"})}a.html(f);a.removeAttr("disabled");a.change(function(i){var h=$("#model").find("option:selected").val();if($("#add").length>0){if(h!==""){$("#add").show()}else{$("#add").hide()}}})}})},testedModelRatings:function(){if($("div.models-tested").length===0){return}$("#rating-data").find("table").each(function(b){var a=((b>0)?"Show":"Hide")+" tested model ratings",c=$(this).prevAll("h3").first().find("span").text();if(c!==""){a=a+" for "+c}$(this).before('<p><a href="#" class="show-hide-tested-models">'+a+"</a></p>")});$("#rating-data").find("table:gt(0)").hide();$("#rating-data").find("a.show-hide-tested-models").click(function(){var a=$(this).text();if($(this).parent().next().is(":visible")){$(this).parent().next().hide();$(this).text(a.replace("Hide","Show"))}else{$(this).parent().next().show();$(this).text(a.replace("Show","Hide"))}return false})},initTabSwitch:function(){$("#inline-tabs").find('a[href ^= "#fragment"]').click(function(){whichcars.tabSwitch($(this));return false});if($("#inline-tabs.showForJS").length>0){var a=location.href.split("#");if(a.length>1&&a[1].indexOf("fragment")===0){whichcars.tabSwitch($("#inline-tabs").find('a[href="#'+a[1]+'"]'))}else{if(a.length===1){whichcars.tabSwitch($("#inline-tabs").find("a:eq(0)"))}}}},tabSwitch:function(a){$("#inline-tabs").find("li").removeClass("current").find("a").show();$("#inline-tabs").find("li span").remove();a.hide().after("<span>"+a.text()+"</span>").parent().toggleClass("current");$('div[id ^= "fragment"]').hide();$(a.attr("href")).show()},modelFinderFilter:{props:{root:"/cars/finder?",dynamicFilters:{1:{name:"#filter-newused",type:"multi",urlParamName:"newAndUsedCars"},2:{name:"#filter-budget",type:"single",urlParamName:"budget"},3:{name:"#filter-bodystyle",type:"multi",urlParamName:"bodyStyle"},4:{name:"#filter-make",type:"multi",urlParamName:"makes"}},defaultParams:{"submit-master":"",view:"25",reviewindex:"0",filterMode:"on"},resultRefreshText:"Results updated"},init:function(){if($("#filter-options").length===0){return}$("#filter-options").find("input").click(function(){whichcars.modelFinderFilter.loadReviewFinderResults(true,true)});$("#filter-bodystyle, #filter-make").each(function(){$(this).prepend('<p class="local-options"><a href="#" onclick="whichcars.modelFinderFilter.selectAll(\'#'+$(this).attr("id")+'\', true); return false;">Select all</a> | <a href="#"  onclick="whichcars.modelFinderFilter.clearAll(\'#'+$(this).attr("id")+"', true); return false;\">Clear all</a></p>")});$("#filter-options").find('button[type="submit"]').hide();$("#filter-options").find("button.btn-reset").click(function(){whichcars.modelFinderFilter.clearAll("#filter-budget",false);whichcars.modelFinderFilter.clearAll("#filter-bodystyle",false);whichcars.modelFinderFilter.clearAll("#filter-make",true)});$('<div class="ajax-loading">').css({position:"absolute",top:"3.4em",left:"4px"}).appendTo("#filter-options").hide();$('<p class="loader">').css({width:"892px",height:"180px"}).appendTo("#filter-options div.ajax-loading");$("#filter-options").find("div.ajax-loading").ajaxStart(function(){$(this).show()}).ajaxStop(function(){$(this).fadeOut()})},selectAll:function(b,a){$(b).find("input").attr("checked","checked").blur();if(a){whichcars.modelFinderFilter.loadReviewFinderResults(true,true)}},clearAll:function(b,a){$(b).find("input").removeAttr("checked").blur();if(a){whichcars.modelFinderFilter.loadReviewFinderResults(true,true)}},queryBuilder:function(){var i,a,c,b,g,f="",h=whichcars.modelFinderFilter.props.dynamicFilters,d=whichcars.modelFinderFilter.props.defaultParams,e=function(){f+="&"+a.urlParamName+"="+$(this).attr("value")};for(i in h){if(h.hasOwnProperty(i)){a=h[i];c=$(a.name+" input:checked");if(a.type==="single"){if(c.val()){f+="&_"+a.urlParamName+"=on";f+="&"+a.urlParamName+"="+c.val()}}else{if(a.type==="multi"){c.each(e)}}if(c.length>0){f+="&_"+a.urlParamName+"=on"}}}if($("div.view-per-page").length>0){if($("div.view-per-page:first li:eq(0) a").length===0){f+="&fullreviewshow=10"}else{if($("div.view-per-page:first li:eq(2) a").length===0){f+="&fullreviewshow=50"}else{f+="&fullreviewshow=25"}}}else{f+="&fullreviewshow=25"}g=$("select#fullReviewSortOptionTop").find("option:selected");if(g.length>0){f+="&fullReviewSortOption="+g.val()}else{f+="&fullReviewSortOption=15"}for(b in d){if(d.hasOwnProperty(b)){f+="&"+b+"="+d[b]}}f=f.replace(/\\?&/,"");return whichcars.modelFinderFilter.props.root+f},ajaxModelResults:function(a,b){if(typeof(b)!=="undefined"){b.abort()}b=$.ajax({type:"GET",url:a,dataType:"html",timeout:40000,error:function(c,e,d){whichcars.modelFinderFilter.showModelResultsError("Code: 557.")},success:function(c){if(c===undefined){whichcars.modelFinderFilter.showModelResultsError("Code: 562.")}else{if(c.length===0){whichcars.modelFinderFilter.showModelResultsError("Code: 566.")}else{$("#filter-options").find("p").remove(":contains('error')");if($("#results").length>0){if(c.indexOf("Login")>0){window.location.href="/login"}else{$("#results").html(c)}}else{$("#filter-options").after(c)}$(".view-per-page a, .pagination a").click(function(){whichcars.modelFinderFilter.ajaxModelResults($(this)[0].href,b);return false});$("#inline-tabs").tabs();$(".showForJS").show();$("#results").css({position:"relative"});$("#results").append('<div id="resultsMessage">'+whichcars.modelFinderFilter.props.resultRefreshText+"</div>");$("#resultsMessage").css({position:"absolute",top:"50px",left:"300px",width:"300px",padding:"30px 0",border:"solid 3px #C5D2D8",background:"#E7EEF2",color:"#C00","font-size":"160%","text-align":"center"}).animate({opacity:0},2000,function(){$("#resultsMessage").remove()})}}}})},loadReviewFinderResults:function(a,e){var c=whichcars.modelFinderFilter.props.dynamicFilters[1],d=$(c.name+" input:checked"),f,b;if(d.val()!==undefined){b=whichcars.modelFinderFilter.queryBuilder();$("#errorMsgNewUsed").empty();$(this).blur();if(b.length!==0||e){whichcars.modelFinderFilter.ajaxModelResults(b,f)}}else{if(a){$("#errorMsgNewUsed").empty().append("<p class='error'>Please choose new or used option</p>")}}},showModelResultsError:function(a){$("#filter-options").find("p").remove(":contains('error')").append("<p class='error'>Unfortunately, an error occurred. "+a+" Please try again.</p>")}},newsletterclearonfocus:function(){$("#newsletterSignUp").focus(function(){if($(this).val()==="Please enter your email"){$(this).val("")}}).blur(function(){if($(this).val()===""){$(this).val("Please enter your email")}})},setupCarsLightboxInvoker:function(){$(".cars-intermediate-link").click(function(){var a=$(this).attr("href");whichcars.showModifiedLightbox(a);return false})},showModifiedLightbox:function(b){var a=b+"?height=595&width=521&modal=true";tb_show("",a,false);return false}};var carsLightboxes={savedLBLogin:"",savedLinkName:"",savedLinkURL:"",dynamicLink:false,log:function(b){var a=window.console;if(a&&a.log){a.log(b)}},setupLightbox:function(){var b=$("#idlink"),a=b.text();$("button.valuations-link").unbind().click(function(){this.form.submit()});carsLightboxes.savedLinkName=a;carsLightboxes.savedLBLogin=$("#lblogin").attr("href");carsLightboxes.savedLinkURL=adtech.adclickL2+b.attr("href");if(b.attr("rel")!==""){carsLightboxes.defaultLinkName=b.attr("rel")}if(typeof(adtech.adclickL2)!=="undefined"){carsLightboxes.defaultLinkHref=adtech.adclickL2+carsLightboxes.defaultLinkHref}else{carsLightboxes.defaultLinkHref="http://adtech.which.co.uk/adlink|987|2381942|0|2973|AdId=2886351;BnId=14;itime=259234922;nodecode=yes;link="+carsLightboxes.defaultLinkHref}if(carsLightboxes.savedLinkName.indexOf("{link.")>=0){carsLightboxes.dynamicLink=true}if(carsLightboxes.dynamicLink){b.text(carsLightboxes.defaultLinkName);b.attr("href",carsLightboxes.defaultLinkHref)}},showValuationsLightbox:function(a){if($("#carslightbox").size()===0){carsLightboxes.log("Unable to find valuations lightbox in page");window.location.href=$(a).attr("href");return false}if($("#carslightbox-panel").find(".innerTwo").size()===0){$("#carslightbox-panel").append($("#valuations-panel").detach())}$("#carslightbox-panel").find(".inner").hide().end().find(".innerTwo").show();var b=tb_close_callback;tb_close_callback=function(){tb_close_callback=b;$("#carslightbox-panel").find(".inner").show().end().find(".innerTwo").hide()};tb_show("","TB_inline?inlineId=carslightbox&height=600&width=600&modal=true",false);return false}};$(window).load(function(){setTimeout(carsLightboxes.setupLightbox,600)});$(document).ready(function(){whichcars.navigationHoverInit();whichcars.modelFinder("#model-finder");whichcars.modelFinder("#car-finder");if($("#inline-help").length>0){whichcars.helpPopup()}whichcars.testedModelRatings();whichcars.initTabSwitch();$(".showForJS").show();whichcars.newsletterclearonfocus();whichcars.accordion("#how-we-test");whichcars.accordion("#standard-equipment");whichcars.accordion("#optional-extras");whichcars.accordion("#side-by-side");$("#manufacturer-reviews").find(".inner").tabs();$("#recommended").tabs();whichcars.drillDownOption("#review-finder","CarReviewSelectorComponent");whichcars.drillDownOption("#model-comparator-selector","CarModelComparisonComponent");whichcars.drillDownOption("#range-comparator-selector","CarRangeComparisonComponent");$("#best-buys").tabs();$("#tabs").tabs();$(".tabify").tabs();$("#results").find("#inline-tabs").tabs();whichcars.modelFinderFilter.init();whichcars.setupCarsLightboxInvoker()});