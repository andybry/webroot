"use strict";var SIGNUP={ADDRESS:{},PRINT:{},RESPONSYS:function(){},VALIDATION:{makeRequiredRule:function(){},fieldErrorMessages:{}}};SIGNUP={clientSideTest:"",giftSub:false,formErrors:{},initialPostTown:"",msgROIBeforeAddressLine1:'<p class="msgROIBeforeAddressLine1">Please enter your address</p>',processMsg:"",postCodeLookup:{searchHouseNumberSelector:"#lookupHouseNumber",searchPostcodeSelector:"#lookupPostCode",addressDropDownSelector:"#selectAddress",addressLine0Selector:"#addressLine1",addressLine1Selector:"#addressLine2",townSelector:"#postTown",postcodeSelector:"#postCode",errorMessages:{ERR01_AddressNotFound:"We were unable to find your address. Please try again or type your address below.",ERR02_TooManyResults:"Too many results.",ERR03_MissingHouseNumber:"Please enter a house number or name.",ERR04_MissingHouseNumberAndPostcode:"You need to provide your house name or number and postcode.",ERR05_MissingPostcode:"Please enter a UK postcode.",ERR06_InvalidPostcode:"Please enter a valid UK postcode.",ERR07_ConnectionProblem:"Sorry, there is a problem with the connection to the postcode lookup service.<br/>Please enter your details below instead.",ERRXX_UnknownProblem:"Sorry, an unknown problem occurred with the postcode lookup service.<br/>Please enter your details below instead."},helpMessages:{oneAddressFound:"We found one address matching the details you provided. If this address is not correct please edit the details below."}},country:{displayCountryText:'<div class="fieldWrapper displayCountryWrapper"><label>Country</label><span id="displayCountryLabel">[countryName]</span></div>',returnedFromServer:false,init:function(){if($("#addressLine1").val()!==""||$("#addressLine2").val()!==""||$("#postCode").val()!==""||$("#postTown").val()!==""){this.returnedFromServer=true;SIGNUP.country.select($("#countryId option:selected").val());$("#lookupPostCode").attr("value",$("#postCode").val());$("#addressLine1, #addressLine2, #postCode, #postTown").parent().show()}else{$("#addressLine1, #addressLine2, #postCode, #postTown").parent().hide()}},initGiftSub:function(){if(($("#addressLine1").val()!==""&&$("#addressLine1").val()!==$("#addressLine1").attr("placeholder"))||($("#addressLine2").val()!==""&&$("#addressLine2").val()!==$("#addressLine2").attr("placeholder"))||($("#postCode").val()!==""&&$("#postCode").val()!==$("#postCode").attr("placeholder"))||($("#postTown").val()!==""&&$("#postTown").val()!==$("#postTown").attr("placeholder"))){this.returnedFromServer=true;SIGNUP.country.select($("#countryId option:selected").val());$("#lookupPostCode").attr("value",$("#postCode").val());$("#addressLine1, #addressLine2, #postCode, #postTown").parent().show()}else{$("#addressLine1, #addressLine2, #postCode, #postTown").parent().hide();if($("#addressLine1").hasClass("fieldError")||$("#addressLine2").hasClass("fieldError")){$("#lookupHouseNumber").addClass("fieldError").after('<img src="/assets/images/content/gift-subscriptions/form-cross.png">')}if($("#postCode").hasClass("fieldError")||$("#postTown").hasClass("fieldError")){$("#lookupPostCode").addClass("fieldError").after('<img src="/assets/images/content/gift-subscriptions/form-cross.png">')}}if(($("#addressLine1To").val()!==""&&$("#addressLine1To").val()!==$("#addressLine1To").attr("placeholder"))||($("#addressLine2To").val()!==""&&$("#addressLine2To").val()!==$("#addressLine2To").attr("placeholder"))||($("#postCodeTo").val()!==""&&$("#postCodeTo").val()!==$("#postCodeTo").attr("placeholder"))||($("#postTownTo").val()!==""&&$("#postTownTo").val()!==$("#postTownTo").attr("placeholder"))){this.returnedFromServer=true;SIGNUP.country.select($("#countryIdTo option:selected").val());$("#lookupPostCodeTo").attr("value",$("#postCodeTo").val());$("#addressLine1To, #addressLine2To, #postCodeTo, #postTownTo").parent().show()}else{$("#addressLine1To, #addressLine2To, #postCodeTo, #postTownTo").parent().hide();if($("#addressLine1To").hasClass("fieldError")||$("#addressLine2To").hasClass("fieldError")){$("#lookupHouseNumberTo").addClass("fieldError").after('<img src="/assets/images/content/gift-subscriptions/form-cross.png">')}if($("#postCodeTo").hasClass("fieldError")||$("#postTownTo").hasClass("fieldError")){$("#lookupPostCodeTo").addClass("fieldError").after('<img src="/assets/images/content/gift-subscriptions/form-cross.png">')}}$("#alreadyRequestedEmailAddress").val("true")},select:function(a){if(typeof a==="undefined"||a===null){return}if(a.toLowerCase()==="republic of ireland"){SIGNUP.country.ROI(a)}else{SIGNUP.country.UK(a)}},ROI:function(c){var b=$("#addressLine1").parent().html(),a=$('label[for="postCode"]');$("#lookupPostCode, #lookupHouseNumber, #findAddressButton, #selectAddress").parent().hide();$("#addressIntro2").hide();if(b.indexOf(SIGNUP.msgROIBeforeAddressLine1)===-1){$("#addressLine1").parent().parent().before(SIGNUP.msgROIBeforeAddressLine1)}$("#countryId").blur();a.find(".mandatory").hide();a.append('<span class="not-mandatory">&nbsp;&nbsp;</span>');delete SIGNUP.VALIDATION.validationRules.postCode;delete SIGNUP.VALIDATION.validationRules.lookupPostCode;if(!this.returnedFromServer){$("#addressLine1, #addressLine2, #postCode, #postTown").val("")}else{this.returnedFromServer=false}$("#addressLine1, #addressLine2, #postCode, #postTown").parent().show();SIGNUP.country.displayLabel(c)},UK:function(b){var a=$('label[for="postCode"]');$("#lookupPostCode, #lookupHouseNumber, #findAddressButton").parent().show();$("#addressIntro1, #addressIntro2").show();$("p.msgROIBeforeAddressLine1").remove();a.find(".not-mandatory").hide();a.find(".mandatory").show();SIGNUP.VALIDATION.validationRules.postCode=SIGNUP.addressRequired;SIGNUP.VALIDATION.validationRules.lookupPostCode=SIGNUP.VALIDATION.postCodeRequired;if(this.returnedFromServer){this.returnedFromServer=false}else{$("#addressLine1, #addressLine2, #postCode, #postTown").val("");$("#addressLine1, #addressLine2, #postCode, #postTown").parent().hide()}SIGNUP.country.displayLabel(b)},displayLabel:function(a){if($("#displayCountryLabel").length>0){$("#displayCountryLabel").html(a)}else{$("#postCode").parent().parent().after(SIGNUP.country.displayCountryText.replace("[countryName]",a))}}},removeErrorField:function(a){a.removeClass("error").removeClass("fieldError");a.parents("div.fieldWrapper, div.fieldWrapperInline").find(".error").remove().end().find("img").remove()},applyErrorField:function(a,d){var c,b;if(SIGNUP.VALIDATION.validationRules){b=SIGNUP.VALIDATION.validationRules[a.attr("id")];c=b(a.val())}else{c=a.attr("title")}$('<p class="error">'+c+"</p>").prependTo(d)},processSignup:function(){window.scrollTo(0,0);$("#signUp").fadeTo("normal",0.2);$(".sign-up").fadeTo("normal",0.2);$("#processing").show();$("select").hide();$("#confirmOrder").click(function(a){a.preventDefault()})},boxNumbers:function(a){var c,b="";for(c=0;c<a.length;c+=1){b+="<span>"+a.substring(c,c+1)+"</span>"}return b},removeDuplicates:function(b){var e,c="",d,a=[];for(d=0;d<b.length;d+=1){e=b[d];if(e!==c){a[a.length]=e}c=e}return a},removeThrobber:function(){$("#throbber").remove()},displayThrobber:function(){SIGNUP.removeThrobber();$("#findAddressButton").after('<img id="throbber" src="/assets/images/content/sign-up/throbber.gif" alt=""/>')},removeError:function(){$("#errorMessage").remove();$("#lookupPostCode").parent().find(".error").remove();if(SIGNUP.giftSub){$("#lookupHouseNumber, #lookupPostCode, #selectAddress, #addressLine1, #addressLine2, #postCode, #postTown").removeClass("fieldError").parent().find("img").remove()}},displayLocalError:function(b,a,c){var d=b;SIGNUP.removeThrobber();if(SIGNUP.postCodeLookup.errorMessages[b]){d=SIGNUP.postCodeLookup.errorMessages[b]}else{d=SIGNUP.postCodeLookup.errorMessages.ERRXX_UnknownProblem}if(c){SIGNUP.removeError()}if(SIGNUP.clientSideTest===true){SIGNUP.VALIDATION.validateField(a,false)}else{b="";$(a).parent().prev().append('<div id="errorMessage"><p class="error">'+d+"</p></div>")}if(b===""||b==="ERR01_AddressNotFound"||b==="ERR07_ConnectionProblem"||b==="ERRXX_UnknownProblem"){$("#addressLine1, #addressLine2, #postCode, #postTown").parent().show();SIGNUP.country.displayLabel("United Kingdom")}},displayRemoteError:function(a){SIGNUP.displayLocalError(a.responseText,SIGNUP.postCodeLookup.addressDropDownSelector)},showAddressFields:function(){$("#addressLine1, #addressLine2, #postCode, #postTown").parent().show();if(SIGNUP.giftSub){if($("#addressLine1").val()!==""&&$("#addressLine1").val()!==$("#addressLine1").attr("placeholder")){$("#addressLine1").removeClass("placeholder")}if($("#addressLine2").val()!==""&&$("#addressLine2").val()!==$("#addressLine2").attr("placeholder")){$("#addressLine2").removeClass("placeholder")}if($("#postCode").val()!==""&&$("#postCode").val()!==$("#postCode").attr("placeholder")){$("#postCode").removeClass("placeholder")}if($("#postTown").val()!==""&&$("#postTown").val()!==$("#postTown").attr("placeholder")){$("#postTown").removeClass("placeholder")}}},showSelectField:function(){$("#selectAddress").parent().show()},getAddressLineDetails:function(f,e,a){var g,c=a,b,d;if(f&&e){if($.isArray(f)){for(b=0;b<f.length;b+=1){g=f[b];d=g.lineType;if(d===e){c=g.details;if(!c||c===null){c=a}return c}}}else{c=f.details}}return c},populateDropDownWithResults:function(c){var a,b=$(SIGNUP.postCodeLookup.addressDropDownSelector);$(b).children().remove();$(b).append('<option value="-1">Please select...</option>');if($.isArray(c)){for(a=0;a<c.length;a+=1){$(b).append('<option value="'+c[a].addressId+'">'+SIGNUP.getAddressLineDetails(c[a].addressLines,"singleLineAddress")+"</option>")}}else{$(b).append('<option value="'+c.addressId+'">'+SIGNUP.getAddressLineDetails(c.addressLines,"singleLineAddress")+"</option>")}},populateAddressDetails:function(b){var f=b.addressLines,e=SIGNUP.getAddressLineDetails(f,"addressLine_1","").substring(0,27),d=SIGNUP.getAddressLineDetails(f,"addressLine_2","").substring(0,31),c=SIGNUP.getAddressLineDetails(f,"townCity","").substring(0,31),a=SIGNUP.getAddressLineDetails(f,"postCode","");$(SIGNUP.postCodeLookup.addressLine0Selector).val(e);$(SIGNUP.postCodeLookup.addressLine1Selector).val(d);$(SIGNUP.postCodeLookup.townSelector).val(c);$(SIGNUP.postCodeLookup.postcodeSelector).val(a);SIGNUP.ADDRESS.lookupCityValue=c;SIGNUP.showAddressFields()},displaySelectedAddress:function(a){SIGNUP.populateAddressDetails(a.address)},clearSelectedAddress:function(){$(SIGNUP.postCodeLookup.addressLine0Selector).val("");$(SIGNUP.postCodeLookup.addressLine1Selector).val("");$(SIGNUP.postCodeLookup.townSelector).val("");$(SIGNUP.postCodeLookup.postcodeSelector).val("")},displayOneAddress:function(a){$("#lookupHouseNumber, #lookupPostCode, #findAddressButton, #outsideUKLink").parent().remove();$("#selectAddress").parent().remove();$("#addressIntro1").remove();$("#addressIntro2").html('<p class="alertMsg"><img height="19" width="21" alt="tick" src="/assets/images/content/sign-up/correct-alert.png"/>'+SIGNUP.postCodeLookup.helpMessages.oneAddressFound+"</p>");$("#lookupCountry").next().hide();$("#country, #lookupCountry").hide();$("#countryDisplay").html("");$("#countryDisplay").parent().show();SIGNUP.populateAddressDetails(a.address);SIGNUP.country.displayLabel($("#countryId option:selected").text())},lookupAndShowAddress:function(a,d){var c=(d)?SIGNUP.displayOneAddress:SIGNUP.displaySelectedAddress,b="/address/address/"+a;SIGNUP.removeError();SIGNUP.clearSelectedAddress();if($(SIGNUP.postCodeLookup.addressDropDownSelector).val()!=="-1"){$.ajax({type:"GET",dataType:"json",timeout:5000,url:b,success:c,error:SIGNUP.displayRemoteError})}},addressSelected:function(){var a=$(SIGNUP.postCodeLookup.addressDropDownSelector+" option:selected").val();SIGNUP.lookupAndShowAddress(a,false)},clearAddressesDropDown:function(){$(SIGNUP.postCodeLookup.addressDropDownSelector).children().remove()},DisplayPostCodeSearchResults:function(a){var b=a.addressList.addresses;this.showResults=function(){if($.isArray(b)){SIGNUP.populateDropDownWithResults(b);SIGNUP.showSelectField();SIGNUP.showAddressFields()}else{SIGNUP.lookupAndShowAddress(b.addressId,true)}SIGNUP.removeThrobber()}},delayDisplayResults:function(a){clearTimeout(SIGNUP.dtimeout);var b=new SIGNUP.DisplayPostCodeSearchResults(a);SIGNUP.dtimeout=setTimeout(b.showResults,200)},lookupAddresses:function(){$("#findAddressButton").blur();$("#selectAddress").parent().hide();SIGNUP.clientSideTest=false;if(!SIGNUP.VALIDATION.validateInputs()){return}SIGNUP.removeError();SIGNUP.displayThrobber();SIGNUP.clearAddressesDropDown();var c=$(SIGNUP.postCodeLookup.searchHouseNumberSelector).val(),b=$(SIGNUP.postCodeLookup.searchPostcodeSelector).val();if(SIGNUP.giftSub){if(c===$(SIGNUP.postCodeLookup.searchHouseNumberSelector).attr("placeholder")){c=""}if(b===$(SIGNUP.postCodeLookup.searchPostcodeSelector).attr("placeholder]")){b=""}}var a="/address/addresses/"+(c===""?"*":c)+"/"+(b===""?" ":b)+"/";$.ajax({type:"GET",dataType:"json",timeout:5000,url:a,success:SIGNUP.delayDisplayResults,error:SIGNUP.displayRemoteError})},showHelp:function(b,d){var a=$(b).height(),c=$(b).offset().top;if(SIGNUP.hideHelpTimer){clearTimeout(SIGNUP.hideHelpTimer);SIGNUP.hideHelpTimer=null}SIGNUP.helpArrow.css("top",c+"px");SIGNUP.helpBrace.height(a);SIGNUP.helpArrow.height(a).show();$("#contextualHelp").find("div").html(d).end().css("top",c+"px").show()},showHelpForField:function(e){var c=$(e),b=c.parents("div.helpWrapper"),d=".h_"+e.id,f=$("<p></p>"),a=$(d+" + p.helpText").html();f.html(a);if(a){SIGNUP.showHelp(b,f)}},switchPayment:function(){if($("select#paymentMethod").val()==="paymentCC"){$("#creditCardSection").show().removeClass("childrenAreHidden");$("#creditCardPreview, #detailsCC").show();$("#directDebitSection").hide().addClass("childrenAreHidden");$("#directDebitPreview, #detailsDD").hide()}else{$("#creditCardSection").hide().addClass("childrenAreHidden");$("#creditCardPreview, #detailsCC").hide();$("#directDebitSection").show().removeClass("childrenAreHidden");$("#directDebitPreview, #detailsDD").show()}},ddPreviewSortCode:function(){var a;if(SIGNUP.VALIDATION.allSortCodeValid()){a=$.map(["ddSort1Field","ddSort2Field","ddSort3Field"],function(c){return $("#"+c).val()});$("#ddPreviewSortCode").html(SIGNUP.boxNumbers(a.join("")));var b=document.getElementById("ddNumberField");if(SIGNUP.VALIDATION.isValid(b)){BANKLOOKUP.getBankAddress(a.join(""),b)}}else{$("#ddPreviewSortCode").html("")}},init:function(){$("#select-button, div.help-area").remove();$("#tsCs, .showForJS").show();$("#supportingInformation, #offerSummary, div.allHelpText, .showForNonJS").hide();$("#closeWindow").click(function(){self.close();return false});$("#printNow").click(function(){self.print();return false});$("#signUp").append('<div id="contextualHelp"><div></div></div>').find("#contextualHelp").hide();SIGNUP.helpArrow=$('<div id="helpArrow"></div>').css({position:"absolute",left:"482px",top:"-900px",height:"0px",width:"20px"}).hide().appendTo("#signUp");SIGNUP.helpBrace=$('<div id="helpArrowBrace"></div>').css({width:"5px",height:"100%","border-right":"1px solid #ccc","border-bottom":"1px solid #ccc","border-top":"1px solid #ccc"}).appendTo(SIGNUP.helpArrow);SIGNUP.helpBar=$('<div id="helpArrowBar"></div>').css({width:"15px",height:"0px","border-top":"1px solid #ccc",position:"absolute",top:"50%",left:"5px"}).appendTo(SIGNUP.helpArrow);SIGNUP.processMsg=['<div id="processing">',"  <p>",'    <img src="/assets/images/icons/processing-spinner.gif"','         height="32" width="32" alt="processing form" />',"  </p>","  <p>Processing your registration...</p>","</div>"].join(" ");$(SIGNUP.processMsg).appendTo("#content").hide();$(".no-label").css("margin-bottom","4px");$("#registrationForm").submit(function(b){var g=$(":input").not(".addressDetail:hidden"),e=true,f,d=[],c,a;g.each(function(j,h){if(!SIGNUP.VALIDATION.validateField(h,"dueToSubmit")){e=false;if(h.id){d.push(SIGNUP.formErrors[h.id])}}});if(!e){$("#form-error-signup").html("");b.preventDefault();$("div#youNeedToComplete").remove();f=$(strErrorMessageWrapPrefix+"<div><p>One or more fields have been missed or completed incorrectly, these are listed below. Please complete or amend appropriately.</p></div>"+strErrorMessageWrapSuffix);c=$("input#confirmOrder");a=$('<ul class="standard"></ul>');f.prependTo("#form-error-signup");d=SIGNUP.removeDuplicates(d);$.each(d,function(j,h){a.append($("<li></li>").text(h))});f.append(a);window.scrollTo(0,0);return false}else{$("#youNeedToComplete, #contextualHelp, #helpArrow").hide();SIGNUP.processSignup();return true}});if(document.getElementById("postTown")){SIGNUP.initialPostTown=document.getElementById("postTown").value}},initStart:function(){$("#emailAddress, #emailAddress2").blur(function(){SIGNUP.RESPONSYS(false)});$("#contact-me").click(function(){SIGNUP.RESPONSYS(true)});$("#TandCBack").find("#closeWindow").text("Close window");$("#TandCBack").find("a").attr("href","#");$("#findAddressButton").click(SIGNUP.lookupAddresses);$(SIGNUP.postCodeLookup.addressDropDownSelector).change(SIGNUP.addressSelected);$("#countryId").change(function(){SIGNUP.country.select($(this).val())});if(SIGNUP.giftSub){SIGNUP.country.initGiftSub()}else{SIGNUP.country.init()}SIGNUP.ADDRESS.setPostTownErrorStatus()},initCC:function(){$("#cPreviewCardType").text($("#ccCardTypeField option:selected").text());$("#ccCardTypeField").blur(function(){$("#cPreviewCardType").text($("#ccCardTypeField option:selected").text())});$("#creditCardName").blur(function(){$("#cPreviewName").text($(this).val())});$("#ccNumberField").blur(function(){$("#cPreviewNumber").text($(this).val())});$("#ccEndMonthField").blur(function(){$("#cPreviewMonthExpiry").text($(this).val())});$("#ccEndYearField").blur(function(){$("#cPreviewYearExpiry").text($(this).val())})},initDD:function(){$("input#ddNameField").blur(function(){$("#ddPreviewName").text($(this).val())});$("input#ddNameField").blur();$("input#ddNumberField").blur(function(){$("#ddPreviewNumber").html(SIGNUP.boxNumbers($(this).val()))});$("input#ddNumberField").blur();$("#ddSort1Field, #ddSort2Field, #ddSort3Field").blur(SIGNUP.ddPreviewSortCode);SIGNUP.ddPreviewSortCode();$("input#firstnameField, input#surnameOrCompany").change(function(){$("input#accountName").val($("input#foreName").val()+" "+$("input#surnameOrCompany").val());$("#ddPreviewName").text($("input#accountName").val())})},initGiftSub:function(){$(".hideLabel").hide();$("#signup-email-confirm").hide();$("[placeholder]").focus(function(){var a=$(this);if(a.val()===a.attr("placeholder")){a.val("");a.removeClass("placeholder")}}).blur(function(){var a=$(this);if(a.val()===""||a.val()===a.attr("placeholder")){a.addClass("placeholder");a.val(a.attr("placeholder"))}}).blur();$("#registrationForm").submit(function(){$(this).find("[placeholder]").each(function(){var b=$(this);if(b.val()==b.attr("placeholder")){b.val("")}});if($("#emailAddressTo").val()===""){var a=this;$("#signup-email-confirm").dialog({title:"Recipient email request",resizable:false,width:400,dialogClass:"signup-email-confirm",modal:true,position:["center",100],buttons:{"Add recipient email":function(){$(this).dialog("close");$("[placeholder]").blur();$("#emailAddressTo").focus()},"Continue anyway":function(){a.submit()}}});$("#signup-email-confirm").dialog("open");return false}})}};SIGNUP.VALIDATION={makeRequiredRule:function(a,b){var d,e=$(a).val();try{d=SIGNUP.VALIDATION.fieldErrorMessages[b]}catch(c){}if(!jQuery.trim(e)){return d}else{return""}},fieldErrorMessages:{addressLine1:"Please enter address line 1.",ccNumberField:"Please enter the card number.",ccNumberFieldLenghth:"The card number must be 13-19 numeric characters in length.",ccEndMonthField:"Please select an expiry date.",ccEndYearField:"Please select an expiry date.",countryId:"Please select a country.",creditCardName:"Please enter the name on the card.",ddNameField:"Please enter the name of the account holder.",ddNumberField:"Please enter an account number.",ddNumberFieldMsg2:"Please enter a valid 8 digit account number.",ddSortField:"Please enter a valid sort code.",emailAddressUsername:"If you want to use an email address as your username, it must be the same as the one given in the Email address field.",emailAddress:"Please enter your email address.",emailAddressInvalid:"Please enter a valid email address.",emailAddress2:"This email address does not match that given above.",emailAddressMsg2:"Please re-enter your email address.",firstName:"Please enter first name.",houseNumber:SIGNUP.postCodeLookup.errorMessages.ERR03_MissingHouseNumber,invalidPostCode:SIGNUP.postCodeLookup.errorMessages.ERR06_InvalidPostcode,lastName:"Please enter last name.",loginPassword:"Please enter a password.",loginPassword2:"This password does not match that given above.",loginPasswordMsg2:"Please re-enter your password.",postTown:"Please enter a Town or City.",postCode:SIGNUP.postCodeLookup.errorMessages.ERR05_MissingPostcode,titleField:"Please select a title.",tsandcs:"You must agree to our Terms & Conditions.",username:"Please enter a username.",usernameMsg2:"Your username must be at least 6 characters in length.",paymentMethod:"Please select a payment method."},isUKPostcode:function(a){var b=new RegExp("^[A-Z]{1,2}[0-9R][0-9A-Z]?[ ]?[0-9][ABD-HJLNP-UW-Z]{2}$","i");return b.test(a)},isUKForcesPostcode:function(a){var b=new RegExp("^(BFPO[ ]?[0-9]{1,4})$","i");return b.test(a)},postCodeRequired:function(a){if(a.length===0){return SIGNUP.VALIDATION.fieldErrorMessages.postCode}if((!SIGNUP.VALIDATION.isUKPostcode(a)&&!SIGNUP.VALIDATION.isUKForcesPostcode(a))){return SIGNUP.VALIDATION.fieldErrorMessages.invalidPostCode}},allSortCodeValid:function(){var a=$.map(["ddSort1Field","ddSort2Field","ddSort3Field"],function(b){return(/^\d{2}$/).exec($("#"+b).val())});return(a.length===3)},sortCodeValid:function(){if(!SIGNUP.VALIDATION.allSortCodeValid()){return SIGNUP.VALIDATION.fieldErrorMessages.ddSortField}},endDateValid:function(){if($("#ccEndMonthField").val()===""||$("#ccEndYearField").val()===""){return SIGNUP.VALIDATION.fieldErrorMessages.ccEndMonthField}},validateEmailAddress:function(a,b){if(!b){b="emailAddress"}if(a.length===0&&b==="emailAddress"){return SIGNUP.VALIDATION.fieldErrorMessages.emailAddress}if(!/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(a)||(a.indexOf("/")>0)){switch(b){case"username":return SIGNUP.VALIDATION.fieldErrorMessages.emailAddressUsername;default:return SIGNUP.VALIDATION.fieldErrorMessages.emailAddressInvalid}}},validationRules:{titleField:function(){return SIGNUP.VALIDATION.makeRequiredRule("#titleField","titleField")},firstName:function(){return SIGNUP.VALIDATION.makeRequiredRule("#firstName","firstName")},lastName:function(){return SIGNUP.VALIDATION.makeRequiredRule("#lastName","lastName")},addressLine1:function(){return SIGNUP.VALIDATION.makeRequiredRule("#addressLine1","addressLine1")},postTown:function(){SIGNUP.ADDRESS.checkCity();return SIGNUP.VALIDATION.makeRequiredRule("#postTown","postTown")},postCode:function(a){return SIGNUP.VALIDATION.postCodeRequired(a)},lookupPostCode:function(a){return SIGNUP.VALIDATION.postCodeRequired(a)},countryId:function(){return SIGNUP.VALIDATION.makeRequiredRule("#countryId","countryRequired")},emailAddress:function(a){return SIGNUP.VALIDATION.validateEmailAddress(a)},emailAddress2:function(a){if(a!==$("input#emailAddress").val()){return SIGNUP.VALIDATION.fieldErrorMessages.emailAddress2}if(!$.trim(a)){return SIGNUP.VALIDATION.fieldErrorMessages.emailAddressMsg2}},loginPassword:function(a){if(a.length<6||a.length>20){return SIGNUP.VALIDATION.fieldErrorMessages.loginPassword}},loginPassword2:function(a){if(a!==$("input#loginPassword").val()){return SIGNUP.VALIDATION.fieldErrorMessages.loginPassword2}if(!$.trim(a)){return SIGNUP.VALIDATION.fieldErrorMessages.loginPasswordMsg2}},username:function(){var a=$("#username").val();if(!$.trim(a)){return SIGNUP.VALIDATION.fieldErrorMessages.username}if(a.length<6){return SIGNUP.VALIDATION.fieldErrorMessages.usernameMsg2}if(a.indexOf("@")>-1){return SIGNUP.VALIDATION.validateEmailAddress(a,"username")}},ddNameField:function(){return SIGNUP.VALIDATION.makeRequiredRule("#ddNameField","ddNameField")},ddNumberField:function(a){if(!$.trim(a)){return SIGNUP.VALIDATION.fieldErrorMessages.ddNumberField}if(!/^\d{8}$/.exec(a)){return SIGNUP.VALIDATION.fieldErrorMessages.ddNumberFieldMsg2}},ddSort1Field:function(){return SIGNUP.VALIDATION.sortCodeValid()},ddSort2Field:function(){return SIGNUP.VALIDATION.sortCodeValid()},ddSort3Field:function(){return SIGNUP.VALIDATION.sortCodeValid()},creditCardName:function(){return SIGNUP.VALIDATION.makeRequiredRule("#creditCardName","creditCardName")},ccNumberField:function(a){if(!$.trim(a)){return SIGNUP.VALIDATION.fieldErrorMessages.ccNumberField}a=a.replace(/\s/g,"");if(!/^\d{13,19}$/.exec(a)){return SIGNUP.VALIDATION.fieldErrorMessages.ccNumberFieldLenghth}a=a.replace(/\s/g,"");if(a.length<13||a.length>19){return SIGNUP.VALIDATION.fieldErrorMessages.ccNumberField}},ccEndMonthField:function(){return SIGNUP.VALIDATION.endDateValid()},ccEndYearField:function(){return SIGNUP.VALIDATION.endDateValid()},tsandcs:function(){if(!$("input#tsandcs").get(0).checked){return SIGNUP.VALIDATION.fieldErrorMessages.tsandcs}},creditDebitCard:function(){if($("#payment-method").find("input:radio:checked").length===0){return SIGNUP.VALIDATION.fieldErrorMessages.paymentMethod}}},validateField:function(d){var c,a=$(d),b,e;SIGNUP.removeErrorField(a);if(a.parents(".childrenAreHidden").length>0){delete SIGNUP.formErrors[a.attr("id")];return true}if(SIGNUP.VALIDATION.validationRules){b=SIGNUP.VALIDATION.validationRules[a.attr("id")]}if(typeof b==="undefined"){return true}c=b(a.val());e=a.parents("div.fieldWrapper, div.fieldWrapperInline");if(c){SIGNUP.formErrors[a.attr("id")]=c;SIGNUP.applyErrorField(a,e);return false}else{delete SIGNUP.formErrors[a.attr("id")];return true}},isValid:function(c){var a=$(c),b=SIGNUP.VALIDATION.validationRules[a.attr("id")];if(typeof b==="undefined"){return true}if(b(a.val())){return false}return true},validateInputs:function(){var a=true,b=$(SIGNUP.postCodeLookup.searchPostcodeSelector).val().replace(/^\s+|\s+$/g,"");if(SIGNUP.giftSub){if(b===$(SIGNUP.postCodeLookup.searchPostcodeSelector).attr("placeholder")){b=""}}if(b===""){SIGNUP.clientSideTest=true;SIGNUP.displayLocalError(SIGNUP.postCodeLookup.errorMessages.ERR05_MissingPostcode,SIGNUP.postCodeLookup.searchPostcodeSelector,true);a=false}else{if(!SIGNUP.VALIDATION.isUKPostcode(b)&&!SIGNUP.VALIDATION.isUKForcesPostcode(b)){SIGNUP.clientSideTest=true;SIGNUP.displayLocalError(SIGNUP.postCodeLookup.errorMessages.ERR06_InvalidPostcode,SIGNUP.postCodeLookup.searchPostcodeSelector,true);a=false}}return a}};SIGNUP.ADDRESS={addressIntro1:'<p id="addressIntro1">Please select your country of residence</p>',addressIntro2:'<p id="addressIntro2">Use the quick address search facility and select your address from the results</p>',lookupHouseNumHTML:'<div class="fieldWrapper"><label for="lookupHouseNumber">House number or name &nbsp;</label><input maxlength="27" type="text" name="lookupHouseNumber" id="lookupHouseNumber" class="text skipValidation" /></div>',lookupPostCode:'<div class="fieldWrapper"><label for="lookupPostCode">Postcode (e.g. SE5 7TR) <span class="mandatory">*</span></label><input maxlength="8" type="text" name="lookupPostCode" id="lookupPostCode" class="text"/></div><div class="fieldWrapper find-address"><a href="#" id="findAddressButton" title="Find address" onclick="return false;"><img src="/assets/images/content/sign-up/btn-find-address.png" alt="Find address" height="26" width="108"/></a></div><div class="fieldWrapper"><p class="qasResultMessage">Please select your address from the drop-down, if it is not available then select the closest match and edit it</p><label for="selectAddress">Select a possible match <span class="mandatory">*</span></label><select id="selectAddress"></select></div>',lookupHouseNumHTMLGiftSub:'<div class="fieldWrapper"><label for="lookupHouseNumber" class="hideLabel">House number or name</label><input maxlength="27" type="text" name="lookupHouseNumber" id="lookupHouseNumber" placeholder="House number or name" class="text skipValidation" /></div>',lookupPostCodeGiftSub:'<div class="fieldWrapper"><label for="lookupPostCode" class="hideLabel">Postcode (e.g. SE5 7TR)</label><input maxlength="8" type="text" name="lookupPostCode" id="lookupPostCode" placeholder="Postcode (e.g. SE5 7TR)" class="text"/></div><div class="fieldWrapper find-address"><a href="#" id="findAddressButton" title="Find address" onclick="return false;" class="signup-button grey small left">Find address</a></div><div class="fieldWrapper"><p class="qasResultMessage">Please select your address from the drop-down, if it is not available then select the closest match and edit it</p><label for="selectAddress" class="hideLabel">Select a possible match</label><select id="selectAddress"></select></div>',setPostTownErrorStatus:function(){var a,b=document.getElementById("postTown").parentNode.getElementsByTagName("p");if(b.length>0){for(a=0;a<b.length;a=a+1){if(b[a].className.indexOf("error")>-1){SIGNUP.ADDRESS.isPostTownAnError="1";break}}}else{SIGNUP.ADDRESS.isPostTownAnError="0"}},isPostTownAnError:"",checkCity:function(){var e=document.getElementById("cityModified"),b=document.getElementById("postTown").value,a=(SIGNUP.initialPostTown.length>0)?SIGNUP.initialPostTown:SIGNUP.ADDRESS.lookupCityValue,d=SIGNUP.ADDRESS.lookupCityValue||"",f=SIGNUP.ADDRESS.isPostTownAnError,c={"0000":true,"0011":false,"0010":true,"1000":true,"1100":true,"1011":false,"0100":false};f+=(a===b)?"1":"0";f+=(d.length>0)?"1":"0";f+=(d===b)?"1":"0";e.value=c[f]||true},init:function(){var a=$("#addressDetails").parent(),b=$("#countryWrapper").html();$("#countryWrapper").children().remove();$("#countryWrapper").hide();a.prepend(SIGNUP.ADDRESS.addressIntro1+b+SIGNUP.ADDRESS.addressIntro2+SIGNUP.ADDRESS.lookupHouseNumHTML+SIGNUP.ADDRESS.lookupPostCode);$("#selectAddress, #addressLine1, #addressLine2, #postCode, #postTown").parent().hide();$("#outsideUKLink").css("display","inline")},initGiftSub:function(){var a=$("#addressDetails").parent(),b=$("#countryWrapper").html();$("#countryWrapper").children().remove();$("#countryWrapper").hide();a.prepend(SIGNUP.ADDRESS.addressIntro1+b+SIGNUP.ADDRESS.addressIntro2+SIGNUP.ADDRESS.lookupHouseNumHTMLGiftSub+SIGNUP.ADDRESS.lookupPostCodeGiftSub);$("#selectAddress, #addressLine1, #addressLine2, #postCode, #postTown").parent().hide()}};SIGNUP.PRINT={ddSetup:function(){var a=$("#viewPrintable");a.find("p.printable span").html('<a href="#" id="printDD">Print your Direct Debit instruction</a>');a.click(function(){self.print();return false})}};SIGNUP.RESPONSYS=function(o){var d,b,e,k,j,l,m,c,p,i=true,g,h,f,a,n;k=$("#emailAddress").val();j=$("#emailAddress2").val();h=$("#sourceCode");f=h.attr("value");if(h.val().indexOf("processed")>0){i=false}if(o){i=true;f=f.replace(/processed/g,"")}if(k!==j){i=false}if(i){e=SIGNUP.VALIDATION.validateEmailAddress($("#emailAddress").val());if(typeof e==="undefined"){g="";n=$("#titleField").val();l=$("#firstName").val();a=$("#lastName").val();d=$("#addressLine1").val();b=$("#addressLine2").val();p=$("#postTown").val();m=$("#postCode").val();c=($("#contact-me").attr("checked")==="checked")?"Y":"N";g+="sourceCode="+f+"&customer.title="+n+"&customer.foreName="+l+"&customer.surnameOrCompany="+a+"&customer.addressLine1="+d+"&customer.addressLine2="+b+"&customer.postTown="+p+"&customer.postCode="+m+"&customer.emailAddress="+k+"&customer.permitPromote="+c;$.ajax({type:"POST",url:"/account/responsys",data:g,success:function(){h.attr("value",f+"processed")}})}}};var MODALWINDOW={dialogboxPrintStylesheet:'<link type="text/css" rel="stylesheet" media="print" href="//www.staticwhich.co.uk/assets/5.9.4-SNAPSHOT/styles/print-dialogbox.css"/>',addDialogboxPrintStylesheet:function(){if($('head link[href="'+MODALWINDOW.css_thickboxPrintStylesheet+'"]').length===0){$("head").append(MODALWINDOW.dialogboxPrintStylesheet)}},TERMS:{YQL:"https://query.yahooapis.com/v1/public/yql?q=SELECT%20*%20FROM%20html%20WHERE%20url%3D%22http%3A%2F%2Fwww.which.co.uk%2Fterms-and-conditions%2F%22%20AND%20xpath%3D%22%2F%2Fdiv[%40id%3D%27content%27]%22&format=xml&callback=MODALWINDOW.TERMS.getTermsConditions",getTermsConditions:function(b){var a=b.results[0];$("#content").append('<div id="terms-and-conditions-content" style="display:none;">'+a+"</div>");$("#terms-and-conditions-content").find("a").attr("target","_blank");$("#terms-and-conditions-content a[href^=#]").removeAttr("target")},init:function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src=MODALWINDOW.TERMS.YQL;document.getElementById("content").appendChild(a);$("#terms-and-conditions").attr("href","#terms-and-conditions-content")}},ALREADYMEMBER:{YQL:"https://query.yahooapis.com/v1/public/yql?q=SELECT%20*%20FROM%20html%20WHERE%20url%3D%22http%3A%2F%2Fwww.which.co.uk%2Fsignup%2Fwhich-magazine-members%2F%22%20AND%20xpath%3D%22%2F%2Fdiv[%40id%3D%27content%27]%22&format=xml&callback=MODALWINDOW.ALREADYMEMBER.getPageContent",getPageContent:function(b){var a=b.results[0];$("#content").append('<div id="already-member-content" style="display:none;">'+a+"</div>");$("#already-member-content").find("a").attr("target","_top");$("#already-member-content a[href^=#]").removeAttr("target")},init:function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src=MODALWINDOW.ALREADYMEMBER.YQL;document.getElementById("content").appendChild(a);$("#existingWexSignup a").attr("href","#already-member-content").addClass("dialogbox").attr("id","already-member")}},dialogSetup:function(){$("#content").find("a.dialogbox").each(function(){var c=$("<div></div>").append($(SIGNUP.processMsg).clone()),b,a;a=$(this).one("click",function(){b=$("#"+a.attr("href").split("#")[1]);var d=function(){return window.innerWidth<650?"auto":650};c.html(b.html()).dialog({title:"Which Online Trial Sign Up",width:d,minHeight:250,maxHeight:500,dialogClass:"which-dialog",modal:true,open:function(){c.dialog("option","buttons",[{text:"Close",click:function(){$(this).dialog("close")}}]);var e=$(this).parent().find(".ui-widget-header");if(e.find("a.print-dialog").length===0){e.append('<a class="print-dialog" onclick="window.print();return false" href="#">Print this page</a>');$(this).find(".back-to-top").remove();MODALWINDOW.addDialogboxPrintStylesheet()}}});a.click(function(){c.dialog("open");return false});return false})})}};$(document).ready(function(){if(document.getElementById("signup-gift")){SIGNUP.giftSub=true;SIGNUP.initGiftSub()}else{SIGNUP.giftSub=false;SIGNUP.init()}if(document.getElementById("signup-start")||document.getElementById("signup-email-confirm")){SIGNUP.initStart()}if(document.getElementById("signup-cc")){SIGNUP.initCC()}if(document.getElementById("signup-dd")){SIGNUP.initDD();SIGNUP.PRINT.ddSetup()}MODALWINDOW.TERMS.init();if(top!==self){MODALWINDOW.ALREADYMEMBER.init()}MODALWINDOW.dialogSetup()});